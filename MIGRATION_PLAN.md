# –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –ö—É–¥–∞—á

## ‚úÖ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ù–æ—è–±—Ä—å 2024)

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Frontend**: Vue 2.7 + TypeScript + Vuetify 2 + Vite 5
- **OAuth**: Yandex Cloud Functions + VK ID API v5.199 (—Å PKCE)
- **Database**: Firebase Firestore
- **Auth**: Firebase Auth (custom tokens)
- **Secrets**: Yandex Lockbox
- **Deployment**: Firebase Hosting (frontend) + Yandex Cloud Functions (OAuth)

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ VK OAuth —Å PKCE (–Ω–æ–≤—ã–π VK ID API)
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Yandex Cloud Function
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ Yandex Lockbox
- ‚úÖ Firebase Firestore –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Firebase Auth –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Vue Frontend  ‚îÇ
‚îÇ  (Firebase      ‚îÇ
‚îÇ   Hosting)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                 ‚îÇ
         ‚ñº                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Yandex Cloud   ‚îÇ  ‚îÇ   Firebase   ‚îÇ
‚îÇ   Function      ‚îÇ  ‚îÇ  Firestore   ‚îÇ
‚îÇ   (authvk)      ‚îÇ  ‚îÇ   + Auth     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   VK ID API     ‚îÇ
‚îÇ   (OAuth 2.1)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏

### –§–∞–∑–∞ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ VK API (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã VK API –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ –∏–ª–∏ —É—Å—Ç–∞—Ä–µ—Ç—å.

**–ó–∞–¥–∞—á–∏:**
1. –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –≤—Å–µ—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö VK API –º–µ—Ç–æ–¥–æ–≤
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å v5.199
3. –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è
4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ VK API

**–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- `src/vk.ts` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å VK API
- `yandex-functions/authvk/index.js` - OAuth —Ñ—É–Ω–∫—Ü–∏—è
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ VK API

**–ú–µ—Ç–æ–¥—ã VK API –≤ –ø—Ä–æ–µ–∫—Ç–µ:**
- `users.get` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- OAuth endpoints - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ò–∑—É—á–∏—Ç—å changelog VK API v5.199
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å deprecated –º–µ—Ç–æ–¥—ã
3. –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è VK API

### –§–∞–∑–∞ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Firebase (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–ü—Ä–æ–±–ª–µ–º–∞**: Firebase SDK –º–æ–∂–µ—Ç —É—Å—Ç–∞—Ä–µ—Ç—å, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

**–¢–µ–∫—É—â–∏–µ –≤–µ—Ä—Å–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏–∏ –≤ `package.json` –∏ `functions/package.json`
- Firebase Admin SDK
- Firebase Client SDK
- Firebase Functions SDK

**–ó–∞–¥–∞—á–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ Firebase SDK
2. –ò–∑—É—á–∏—Ç—å breaking changes –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö
3. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–ü–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

#### –®–∞–≥ 1: –ê—É–¥–∏—Ç —Ç–µ–∫—É—â–∏—Ö –≤–µ—Ä—Å–∏–π
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏–∏
cat package.json | grep firebase
cat functions/package.json | grep firebase

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã
yarn outdated
cd functions && yarn outdated
```

#### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Firebase Admin SDK (–≤ functions)
```bash
cd functions
yarn upgrade firebase-admin@latest
yarn upgrade firebase-functions@latest
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase Admin
- –†–∞–±–æ—Ç–∞ —Å Firestore
- –°–æ–∑–¥–∞–Ω–∏–µ custom tokens
- –¢—Ä–∏–≥–≥–µ—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π

#### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Firebase Client SDK (–≤ frontend)
```bash
yarn upgrade firebase@latest
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å custom token
- –†–∞–±–æ—Ç–∞ —Å Firestore –∏–∑ –∫–ª–∏–µ–Ω—Ç–∞
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ Storage

#### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å emulators
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OAuth flow
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `package.json` - –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `functions/package.json` - —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `src/db.ts` - –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ API
- `functions/src/index.ts` - –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ API

### –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### 3.1 –£–±—Ä–∞—Ç—å –∫–æ—Å—Ç—ã–ª—å —Å –ø–µ—Ä–µ–¥–∞—á–µ–π code_verifier —á–µ—Ä–µ–∑ state

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
`code_verifier` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `state` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `state---code_verifier`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–¥–∏–Ω—ã–π –¥–æ–º–µ–Ω –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–∏
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP-only cookies –¥–ª—è code_verifier
3. –ü–æ–≤—ã—Å–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å OAuth flow

**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

**–í–∞—Ä–∏–∞–Ω—Ç 1: API Gateway**
```
kudach.ru/          ‚Üí Firebase Hosting (frontend)
kudach.ru/authvk    ‚Üí Yandex Cloud Function (OAuth)
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: Firebase Hosting Rewrites**
```json
{
  "hosting": {
    "rewrites": [
      {
        "source": "/authvk",
        "function": "authvk"
      }
    ]
  }
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: Reverse Proxy**
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å nginx/Caddy –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.

#### 3.2 –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

**Yandex Monitoring:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ OAuth —Ñ—É–Ω–∫—Ü–∏–∏
- –û—à–∏–±–∫–∏ VK API
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**Firebase Performance Monitoring:**
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Firestore
- –û—à–∏–±–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

#### 3.3 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**Frontend:**
- Code splitting –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è initial bundle
- Lazy loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- Service Worker –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞

**Backend:**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Firestore
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Firestore indexes

## üîÆ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã

### –í–æ–∑–º–æ–∂–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Yandex Cloud (–±—É–¥—É—â–µ–µ)

**–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Yandex Cloud:**

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –ï–¥–∏–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ (—Ñ—É–Ω–∫—Ü–∏–∏ —É–∂–µ –Ω–∞ Yandex Cloud)
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–∏–∂–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –†–æ—Å—Å–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ Yandex

#### –ß—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
1. **Yandex Database (YDB)** –≤–º–µ—Å—Ç–æ Firestore
2. **Object Storage** –≤–º–µ—Å—Ç–æ Firebase Storage
3. **Cloud Functions** –¥–ª—è –≤—Å–µ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
4. **API Gateway** –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
5. **Lockbox** –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

#### –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:
- **–í—Ä–µ–º—è**: 2-3 –Ω–µ–¥–µ–ª–∏
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –í—ã—Å–æ–∫–∞—è
- **–†–∏—Å–∫–∏**: –°—Ä–µ–¥–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

**–†–µ—à–µ–Ω–∏–µ –æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞:**
- –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞
- –ï—Å—Ç—å —á–µ—Ç–∫–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∏—á–∏–Ω—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

## üìã –ß–µ–∫–ª–∏—Å—Ç –∑–∞–¥–∞—á

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (1-2 –Ω–µ–¥–µ–ª–∏)
- [ ] –ê—É–¥–∏—Ç VK API –º–µ—Ç–æ–¥–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å v5.199
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ VK API
- [ ] –ê—É–¥–∏—Ç –≤–µ—Ä—Å–∏–π Firebase SDK
- [ ] –ò–∑—É—á–µ–Ω–∏–µ breaking changes Firebase
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Firebase Admin SDK
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Firebase Client SDK
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ (1-2 –º–µ—Å—è—Ü–∞)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –µ–¥–∏–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ –¥–ª—è OAuth
- [ ] –£–±—Ä–∞—Ç—å –∫–æ—Å—Ç—ã–ª—å —Å code_verifier –≤ state
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Yandex Cloud
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase Performance Monitoring
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è frontend bundle
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è PKCE

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ (3-6 –º–µ—Å—è—Ü–µ–≤)
- [ ] Code splitting –∏ lazy loading
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Firestore –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD pipeline
- [ ] E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ (6+ –º–µ—Å—è—Ü–µ–≤)
- [ ] –û—Ü–µ–Ω–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Yandex Cloud
- [ ] –ï—Å–ª–∏ –Ω—É–∂–Ω–æ: –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ï—Å–ª–∏ –Ω—É–∂–Ω–æ: –ø—Ä–æ—Ç–æ—Ç–∏–ø –Ω–∞ Yandex Cloud
- [ ] –ï—Å–ª–∏ –Ω—É–∂–Ω–æ: –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

loy## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è Firebase Functions (–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### –¢–µ–∫—É—â–∏–µ Firebase Functions

**1. checkinBalls** - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∑–∞ —á–µ–∫–∏–Ω—ã
- –¢—Ä–∏–≥–≥–µ—Ä: `firestore.document('checkins/{checkin}').onWrite`
- –õ–æ–≥–∏–∫–∞: –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —á–µ–∫–∏–Ω–∞ (`accepted: true`) –Ω–∞—á–∏—Å–ª—è–µ—Ç 50 –±–∞–ª–ª–æ–≤
- –û–±–Ω–æ–≤–ª—è–µ—Ç: `users/{user}/balls/{checkin}` –∏ `rating/{user}`

**2. proposalBalls** - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –¢—Ä–∏–≥–≥–µ—Ä: `firestore.document('proposed/{proposed}').onWrite`
- –õ–æ–≥–∏–∫–∞: –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (`accepted: true`) –Ω–∞—á–∏—Å–ª—è–µ—Ç 20 –±–∞–ª–ª–æ–≤
- –û–±–Ω–æ–≤–ª—è–µ—Ç: `users/{user}/balls/{proposed}` –∏ `rating/{user}`

### –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å)

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ Firebase (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
**–ü–ª—é—Å—ã:**
- –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- Firestore triggers —É–¥–æ–±–Ω—ã –¥–ª—è —Ç–∞–∫–∏—Ö –∑–∞–¥–∞—á
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- –ù–∏–∑–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä–µ–¥–∫–∏–µ –≤—ã–∑–æ–≤—ã)

**–ú–∏–Ω—É—Å—ã:**
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Firebase Functions

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Yandex Cloud Triggers
**–ï—Å–ª–∏ —Ä–µ—à–∏–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å:**

1. **–°–æ–∑–¥–∞—Ç—å Yandex Cloud Triggers –¥–ª—è Firestore**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook –æ—Ç Firebase

2. **–ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏**
   ```
   yandex-functions/
   ‚îú‚îÄ‚îÄ checkin-balls/
   ‚îÇ   ‚îú‚îÄ‚îÄ index.js
   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
   ‚îî‚îÄ‚îÄ proposal-balls/
       ‚îú‚îÄ‚îÄ index.js
       ‚îî‚îÄ‚îÄ package.json
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É**
   - –ó–∞–º–µ–Ω–∏—Ç—å Firebase Admin SDK –Ω–∞ –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Firestore REST API
   - –ò–ª–∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ YDB

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ Firebase –¥–æ –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Yandex Cloud (–µ—Å–ª–∏ –æ–Ω–∞ –≤–æ–æ–±—â–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è). –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π
```bash
# –¢–µ–∫—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ –ø–∞–∫–µ—Ç–æ–≤
yarn list --pattern firebase
cd functions && yarn list --pattern firebase

# –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã
yarn outdated
cd functions && yarn outdated

# –ü—Ä–æ–≤–µ—Ä–∫–∞ VK API
curl "https://api.vk.com/method/users.get?v=5.199&user_ids=1"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
yarn dev

# Firebase emulators
firebase emulators:start

# –õ–æ–≥–∏ Yandex Cloud Function
yc serverless function logs authvk --follow

# –õ–æ–≥–∏ Firebase Functions
firebase functions:log
```

### –î–µ–ø–ª–æ–π
```bash
# OAuth —Ñ—É–Ω–∫—Ü–∏—è
cd yandex-functions/authvk && yarn build && cd ../..
./scripts/deploy-oauth.sh

# Frontend
yarn build
yarn deploy
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### VK API
- [VK API v5.199 Changelog](https://dev.vk.com/ru/reference/version-history)
- [VK ID OAuth Documentation](https://id.vk.com/about/business/go/docs/ru/vkid/latest/vk-id/connection/api-integration/oauth-2-1)
- [VK API Methods](https://dev.vk.com/ru/method)

### Firebase
- [Firebase Release Notes](https://firebase.google.com/support/release-notes/js)
- [Firebase Admin SDK Changelog](https://github.com/firebase/firebase-admin-node/releases)
- [Firebase Migration Guides](https://firebase.google.com/docs/web/modular-upgrade)

### Yandex Cloud
- [Cloud Functions Documentation](https://cloud.yandex.ru/docs/functions/)
- [Lockbox Documentation](https://cloud.yandex.ru/docs/lockbox/)
- [Monitoring Documentation](https://cloud.yandex.ru/docs/monitoring/)

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2024-11-17: VK OAuth –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚úÖ
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω PKCE –¥–ª—è VK OAuth
- –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã–π VK ID API (id.vk.ru/oauth2/auth)
- –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ OAuth —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞ fetch
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex Lockbox
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å redirect_uri
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ VK API –∏ Firebase
- –ê—É–¥–∏—Ç –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ VK API –º–µ—Ç–æ–¥–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Firebase SDK –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –£–ª—É—á—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã OAuth
